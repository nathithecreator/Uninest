<app-nav-dashboard></app-nav-dashboard>
<div class="main-dashboard-section">
  <div class="white-main-section">
    <div class="form-header">
      <button class="goback-btn" (click)="goBack()">
        <i class="bi bi-x-lg"></i>
      </button>
      <h1 class="property-title">Edit Property</h1>
      <div class="divider"></div>
      <p class="form-subtitle">Edit the details for your property listing.</p>
    </div>

    <form (ngSubmit)="updateProperty()" class="property-form">
      <div class="form-section">
        <!-- Basic Property Info -->
        <!-- Property Name -->
        <div class="form-group">
          <label for="propertyName">Property Name</label>
          <input type="text" id="propertyName" [(ngModel)]="property.propertyName" name="propertyName" class="form-control" required>
        </div>

        <!-- Apartment Number -->
        <div class="form-group">
          <label for="unitNumber">Unit/Apartment Number</label>
          <input type="text" id="unitNumber" [(ngModel)]="property.apartmentNumber" name="unitNumber" class="form-control" placeholder="e.g., Unit 5">
        </div>

        <!-- Address Info -->
        <div class="form-group">
          <label for="streetAddress">Street Address</label>
          <input type="text" id="streetAddress" [(ngModel)]="property.streetAddress" name="streetAddress" class="form-control" required>
        </div>

        <div class="form-group">
          <label for="suburb">Suburb</label>
          <input type="text" id="suburb" [(ngModel)]="property.suburb" name="suburb" class="form-control" required>
        </div>

        <div class="form-group">
          <label for="city">City</label>
          <input type="text" id="city" [(ngModel)]="property.city" name="city" class="form-control" required>
        </div>

        <div class="form-group">
          <label for="postalCode">Postal Code</label>
          <input type="text" id="postalCode" [(ngModel)]="property.postalCode" name="postalCode" class="form-control" maxlength="4" required>
        </div>

        <!-- Province -->
        <div class="form-group">
          <label for="province">Province</label>
          <select id="province" [(ngModel)]="property.province" name="province" class="form-control" required>
            <option value="" disabled>Select a Province</option>
            <option value="Eastern Cape">Eastern Cape</option>
            <option value="Free State">Free State</option>
            <option value="Gauteng">Gauteng</option>
            <option value="KwaZulu-Natal">KwaZulu-Natal</option>
            <option value="Limpopo">Limpopo</option>
            <option value="Mpumalanga">Mpumalanga</option>
            <option value="Northern Cape">Northern Cape</option>
            <option value="North West">North West</option>
            <option value="Western Cape">Western Cape</option>
          </select>
        </div>

        <!-- Type, Status, Rent -->
        <div class="form-group">
          <label for="propertyType">Property Type</label>
          <select id="propertyType" [(ngModel)]="property.type" name="propertyType" class="form-control" required>
            <option value="">Select property type</option>
            <option value="apartment">Apartment</option>
            <option value="house">House</option>
            <option value="townhouse">Townhouse</option>
            <option value="studio">Studio</option>
          </select>
        </div>

        <div class="form-group">
          <label for="propertyStatus">Property Status</label>
          <select id="propertyStatus" [(ngModel)]="property.status" name="propertyStatus" class="form-control" required>
            <option value="Available">Available</option>
            <option value="Partially Occupied">Partially Occupied</option>
            <option value="Occupied">Occupied</option>
            <option value="Vacant">Vacant</option>
            <option value="Inactive">Inactive</option>
          </select>
        </div>

        <div class="form-group">
          <label for="monthlyRent">Monthly Rent (R)</label>
          <div class="input-with-icon">
            <span class="currency">R</span>
            <input type="number" id="monthlyRent" [(ngModel)]="property.rentAmount" name="monthlyRent" class="form-control" (input)="calculateFee()" required>
          </div>
          <span class="fee-display">Estimated Listing Fee: R {{listingFee | number:'1.2-2'}} (5%)</span>
        </div>

        <div class="form-group">
          <label for="bedrooms">Number of Bedrooms</label>
          <input type="number" id="bedrooms" [(ngModel)]="property.bedrooms" name="bedrooms" class="form-control" required>
        </div>

        <div class="form-group">
          <label for="description">Description</label>
          <textarea id="description" [(ngModel)]="property.description" name="description" class="form-control" rows="4" required></textarea>
        </div>
      </div>

      <!-- Amenities Section -->
      <div class="form-section">
        <div class="amenities-sections">
          <!-- Transport Options -->
          <div class="form-group transport-section">
            <label>Transport Options</label>
            <div class="multi-input-container">
              <input type="text" placeholder="Transport name" [(ngModel)]="newTransport.name" [ngModelOptions]="{standalone: true}" class="form-control">
              <input type="text" placeholder="Distance/Description" [(ngModel)]="newTransport.description" [ngModelOptions]="{standalone: true}" class="form-control">
              <button type="button" class="add-btn" (click)="addTransport()" [disabled]="!newTransport.name || !newTransport.description">
                <i class="bi bi-plus"></i> Add
              </button>
            </div>
            <div class="items-list" *ngIf="property.transports.length > 0">
              <div class="item-tag" *ngFor="let transport of property.transports; let i = index">
                <span class="item-name">{{transport.name}}</span>
                <span class="item-desc">{{transport.description}}</span>
                <button type="button" class="remove-item" (click)="removeTransport(i)">
                  <i class="bi bi-x"></i>
                </button>
              </div>
            </div>
          </div>

          <!-- Shops & Services -->
          <div class="form-group shops-section">
            <label>Shops & Services</label>
            <div class="multi-input-container">
              <input type="text" placeholder="Shop/Service name" [(ngModel)]="newShop.name" [ngModelOptions]="{standalone: true}" class="form-control">
              <input type="text" placeholder="Distance/Description" [(ngModel)]="newShop.description" [ngModelOptions]="{standalone: true}" class="form-control">
              <button type="button" class="add-btn" (click)="addShop()" [disabled]="!newShop.name || !newShop.description">
                <i class="bi bi-plus"></i> Add
              </button>
            </div>
            <div class="items-list" *ngIf="property.shops.length > 0">
              <div class="item-tag" *ngFor="let shop of property.shops; let i = index">
                <span class="item-name">{{shop.name}}</span>
                <span class="item-desc">{{shop.description}}</span>
                <button type="button" class="remove-item" (click)="removeShop(i)">
                  <i class="bi bi-x"></i>
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Image Upload Section -->
      <div class="form-section">
        <div class="form-group">
          <label>Main Property Image</label>

          <!-- Image Preview -->
          <div class="image-preview-container" *ngIf="imagePreview">
            <img [src]="imagePreview" alt="Selected Image" class="existing-image" />
            <button type="button" class="remove-existing-btn" (click)="removeImage()">
              <i class="bi bi-x"></i> Remove
            </button>
          </div>

          <!-- Upload Input -->
          <div class="file-upload-container" [class.has-file]="selectedFile">
            <input type="file" id="propertyImage" (change)="onFileSelected($event)" accept="image/*" style="display: none;">
            <label for="propertyImage" class="file-upload-btn" style="color: white;">
              <i class="bi bi-cloud-arrow-up"></i> Choose Image
            </label>
            <div class="file-names" *ngIf="selectedFile">
              {{selectedFile.name | slice:0:25 }}
            </div>
            <div class="file-names" *ngIf="!selectedFile && !imagePreview">
              No image chosen
            </div>
          </div>

          <div class="file-requirements">
            <i class="bi bi-info-circle"></i> Accepted formats: JPG, PNG.
          </div>
        </div>
      </div>

      <!-- Submit/Cancel -->
      <div class="form-actions">
        <button type="button" class="cancel-btn" (click)="goBack()">Cancel</button>
        <button type="submit" class="submit-btn" [disabled]="!imagePreview">Save Changes</button>
      </div>
    </form>
  </div>
</div>
